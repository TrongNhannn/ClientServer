{"ast":null,"code":"import _slicedToArray from\"D:/Nhan/DIPE_V2/Client/ClientServer/APP/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{useSelector}from'react-redux';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default(function(props){var field=props.field,changeTrigger=props.changeTrigger,related=props.related,table=props.table,defaultValue=props.defaultValue;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),current=_useState2[0],setCurrent=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),fields=_useState4[0],setFields=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),height=_useState6[0],setHeight=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),foreignData=_useState8[0],setForeignData=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),showKey=_useState10[0],setShowKey=_useState10[1];var _useSelector=useSelector(function(state){return state;}),proxy=_useSelector.proxy,unique_string=_useSelector.unique_string;var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),relatedTable=_useState12[0],setRelatedTable=_useState12[1];useEffect(function(){if(isFieldForeign()){var thisFieldForeignKey=table.fk.filter(function(fk){var fks=fk.fks;var isKeyExisted=fks.filter(function(key){var field_alias=key.field_alias,ref_on=key.ref_on;return field_alias==field.field_alias;})[0];return isKeyExisted?true:false;})[0];var table_alias=thisFieldForeignKey.table_alias,fks=thisFieldForeignKey.fks;if(foreignData.length==0){fetch(\"\".concat(proxy(),\"/api/\").concat(unique_string,\"/apis/table/data/\").concat(table_alias)).then(function(res){return res.json();}).then(function(res){var success=res.success,data=res.data,fields=res.fields,pk=res.pk;setForeignData(data);setFields(fields);var showKey=fks.filter(function(k){return k.field_alias==field.field_alias;})[0].ref_on;setShowKey(showKey);var rTable=related.filter(function(tb){return tb.table_alias==table_alias;})[0];setRelatedTable(rTable);});}}},[]);useEffect(function(){setCurrent(defaultValue);},[defaultValue]);var isFieldForeign=function isFieldForeign(){var isForeign=table.fk.filter(function(key){var fks=key.fks;var fkExisted=fks.filter(function(k){return k.field_alias==field.field_alias;})[0];return fkExisted?true:false;})[0];return isForeign?true:false;};var fieldChangeData=function fieldChangeData(e){var value=e.target.value;setCurrent(e.target.value);changeTrigger(field,value);};var blurTrigger=function blurTrigger(e){e.preventDefault();setTimeout(function(){setHeight(0);},135);};var focusTrigger=function focusTrigger(){setHeight(250);};var generateData=function generateData(data){if(fields.length>0&&current){var showFields=fields;var display_fields=relatedTable.display_fields;if(display_fields&&display_fields.length>0){showFields=display_fields;return showFields.map(function(f){return data[f];}).join(' - ');}return showFields.map(function(f){return data[f.field_alias];}).join(' - ');}else{return null;}};var dataClickedTrigger=function dataClickedTrigger(data){setCurrent(data);changeTrigger(field,data[showKey]);};if(!isFieldForeign()){return/*#__PURE__*/_jsx(\"div\",{className:\"w-100-pct p-1 m-t-1\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"block text-16-px\",children:field.field_name})}),/*#__PURE__*/_jsx(\"div\",{className:\"m-t-0-5\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"p-t-0-5 p-b-0-5 p-l-1 text-16-px block w-100-pct border-1\",placeholder:\"\",onChange:fieldChangeData,value:current})})]})});}else{return/*#__PURE__*/_jsx(\"div\",{className:\"w-100-pct p-1 m-t-1\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"block text-16-px\",children:field.field_name})}),/*#__PURE__*/_jsx(\"div\",{className:\"m-t-0-5\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"p-t-0-5 p-b-0-5 p-l-1 text-16-px block w-100-pct border-1\",placeholder:\"\",onChange:fieldChangeData,defaultValue:generateData(current),onFocus:focusTrigger,onBlur:blurTrigger})}),/*#__PURE__*/_jsx(\"div\",{className:\"rel\",children:/*#__PURE__*/_jsx(\"div\",{className:\"abs-default w-100-pct no-overflow bg-white shadow\",style:{height:\"\".concat(height,\"px\")},children:/*#__PURE__*/_jsx(\"div\",{className:\"block w-100-pct p-0-5 overflow\",style:{height:\"\".concat(height,\"px\")},children:foreignData.map(function(d,index){return/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-no-wrap hover pointer\",onClick:function onClick(){dataClickedTrigger(d);},children:fields?fields.map(function(field){return/*#__PURE__*/_jsx(\"div\",{className:\"div p-0-5 w-max-content\",children:/*#__PURE__*/_jsx(\"span\",{children:d[field.field_alias]})},field.field_id);}):null},index);})})})})]})});}});","map":{"version":3,"names":["useState","useEffect","useSelector","props","field","changeTrigger","related","table","defaultValue","current","setCurrent","fields","setFields","height","setHeight","foreignData","setForeignData","showKey","setShowKey","state","proxy","unique_string","relatedTable","setRelatedTable","isFieldForeign","thisFieldForeignKey","fk","filter","fks","isKeyExisted","key","field_alias","ref_on","table_alias","length","fetch","then","res","json","success","data","pk","k","rTable","tb","isForeign","fkExisted","fieldChangeData","e","value","target","blurTrigger","preventDefault","setTimeout","focusTrigger","generateData","showFields","display_fields","map","f","join","dataClickedTrigger","field_name","d","index","field_id"],"sources":["D:/Nhan/DIPE_V2/Client/ClientServer/APP/src/cpn/client/version/inputs/char.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useSelector } from 'react-redux';\r\n\r\nexport default ( props ) => {\r\n    const { field, changeTrigger, related, table, defaultValue } = props;\r\n    const [ current, setCurrent ] = useState('')\r\n    const [ fields, setFields ] = useState([])\r\n    const [ height, setHeight ] = useState(0)\r\n    const [ foreignData, setForeignData ] = useState([])\r\n    const [ showKey, setShowKey ] = useState(\"\")\r\n    const { proxy, unique_string } = useSelector( state => state );\r\n    const [ relatedTable, setRelatedTable ] = useState({})\r\n\r\n    useEffect(() => {\r\n\r\n        if( isFieldForeign()){\r\n            const thisFieldForeignKey = table.fk.filter( fk => {\r\n                const { fks } = fk;\r\n                const isKeyExisted = fks.filter( key => {\r\n                    const { field_alias,  ref_on } = key;\r\n                    return field_alias == field.field_alias;\r\n                })[0]\r\n                return isKeyExisted ? true : false;\r\n            })[0];\r\n\r\n            const { table_alias, fks } = thisFieldForeignKey;\r\n            if( foreignData.length == 0 ){\r\n                fetch(`${ proxy()}/api/${ unique_string }/apis/table/data/${ table_alias }`).then( res => res.json() ).then( res => {\r\n                    const { success, data, fields, pk } = res;\r\n                    setForeignData( data )\r\n                    setFields(fields)\r\n                    const showKey = fks.filter(k => k.field_alias == field.field_alias )[0].ref_on\r\n                    setShowKey(showKey)\r\n                    const rTable = related.filter( tb => tb.table_alias == table_alias )[0];\r\n                    setRelatedTable(rTable)\r\n                })\r\n            }\r\n        }\r\n\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        setCurrent(defaultValue)\r\n    }, [defaultValue])\r\n\r\n    const isFieldForeign = () => {\r\n        const isForeign = table.fk.filter( key => {\r\n            const { fks } = key;\r\n            const fkExisted = fks.filter(  k => k.field_alias == field.field_alias )[0]\r\n            return fkExisted ? true : false\r\n        })[0]\r\n        return isForeign ? true : false;\r\n    }\r\n\r\n    const fieldChangeData = (e) => {\r\n        const value = e.target.value\r\n        setCurrent( e.target.value )\r\n        changeTrigger( field, value )\r\n    }\r\n\r\n    const blurTrigger = (e) => {\r\n            e.preventDefault();\r\n            setTimeout(() => {\r\n                setHeight(0)\r\n        }, 135)\r\n    }\r\n\r\n    const focusTrigger = () => {\r\n        setHeight(250);\r\n    }\r\n\r\n    const generateData = ( data ) => {\r\n\r\n        if( fields.length > 0 && current ){\r\n            let showFields = fields;\r\n            const { display_fields } = relatedTable;\r\n\r\n            if( display_fields && display_fields.length > 0 ){\r\n                showFields = display_fields;\r\n                return showFields.map( f => data[f] ).join(' - ')\r\n            }\r\n\r\n            return showFields.map( f => data[ f.field_alias ] ).join(' - ')\r\n\r\n        }else{\r\n            return null\r\n        }\r\n    }\r\n\r\n    const dataClickedTrigger = ( data ) => {\r\n        setCurrent( data );\r\n        changeTrigger( field, data[ showKey ] )\r\n    }\r\n\r\n    if( !isFieldForeign() ){\r\n        return(\r\n            <div className=\"w-100-pct p-1 m-t-1\">\r\n                <div>\r\n                    <div>\r\n                        <span className=\"block text-16-px\">{ field.field_name }</span>\r\n                    </div>\r\n                    <div className=\"m-t-0-5\">\r\n                        <input type=\"text\"\r\n                            className=\"p-t-0-5 p-b-0-5 p-l-1 text-16-px block w-100-pct border-1\"\r\n                            placeholder=\"\" onChange={ fieldChangeData } value={ current }\r\n                            />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }else{\r\n        return(\r\n            <div className=\"w-100-pct p-1 m-t-1\">\r\n                <div>\r\n                    <div>\r\n                        <span className=\"block text-16-px\">{ field.field_name }</span>\r\n                    </div>\r\n                    <div className=\"m-t-0-5\">\r\n                        <input type=\"text\"\r\n                            className=\"p-t-0-5 p-b-0-5 p-l-1 text-16-px block w-100-pct border-1\"\r\n                            placeholder=\"\" onChange={ fieldChangeData } defaultValue={ generateData(current) }\r\n                            onFocus={ focusTrigger }\r\n                            onBlur={ blurTrigger }\r\n                            />\r\n\r\n                        {/* FOREIGN DATA SHOW AND CHOSE */}\r\n                        </div>\r\n                    <div className=\"rel\">\r\n                        <div className=\"abs-default w-100-pct no-overflow bg-white shadow\" style={{ height: `${ height }px` }}>\r\n                            <div className=\"block w-100-pct p-0-5 overflow\" style={{ height: `${ height }px` }}>\r\n                            { foreignData.map( (d, index) =>\r\n                                 <div key={ index } className=\"flex flex-no-wrap hover pointer\" onClick={ () => { dataClickedTrigger( d ) } }>\r\n                                    { fields ? fields.map( field =>\r\n                                        <div key={field.field_id} className=\"div p-0-5 w-max-content\">\r\n                                            <span>{ d[ field.field_alias ] }</span>\r\n                                        </div>\r\n                                    ) : null }\r\n                                 </div>\r\n                              )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}