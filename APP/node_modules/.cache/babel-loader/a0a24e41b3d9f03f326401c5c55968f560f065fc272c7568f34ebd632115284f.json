{"ast":null,"code":"import _slicedToArray from\"D:/Nhan/DIPE_V2/Client/DIPE/APP/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{useSelector}from'react-redux';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default(function(props){var field=props.field,changeTrigger=props.changeTrigger,defaultValue=props.defaultValue;var _useState=useState(defaultValue?defaultValue:\"\"),_useState2=_slicedToArray(_useState,2),current=_useState2[0],setCurrent=_useState2[1];var _useSelector=useSelector(function(state){return state;}),unique_string=_useSelector.unique_string,proxy=_useSelector.proxy;var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),_fk=_useState4[0],_setFk=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),fkData=_useState6[0],setFkData=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),fields=_useState8[0],setFields=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),height=_useState10[0],setHeight=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),keyField=_useState12[0],setKeyField=_useState12[1];useEffect(function(){if(field.constraints&&field.constraints.length>0){var fks=field.constraints.filter(function(c){return c.constraint_type===\"fk\";});var fk=fks[0];_setFk(1);fetch(\"\".concat(proxy,\"/api/\").concat(unique_string,\"/table/foreign/data/\").concat(fk.reference_on)).then(function(res){return res.json();}).then(function(res){var data=res.data,table=res.table;setFkData(data);fetch(\"\".concat(proxy,\"/api/\").concat(unique_string,\"/table/\").concat(table.table_id,\"/fields\")).then(function(res){return res.json();}).then(function(res){var fields=res.fields;setFields(fields);var foreignField=fields.filter(function(f){return f.field_id===fk.reference_on;})[0];setKeyField(foreignField.field_alias);});});}if(field.props.props.AUTO_INCREMENT){fetch(\"\".concat(proxy,\"/api/\").concat(unique_string,\"/table/create/auto/increment/template/\").concat(field.field_alias)).then(function(res){return res.json();}).then(function(_ref){var result=_ref.result;var auto_id=result;setCurrent(auto_id);changeTrigger(field,auto_id);/* LATENCY BUG */});}},[]);var fieldChangeData=function fieldChangeData(e){if(!field.props.props.AUTO_INCREMENT){var value=e.target.value;changeTrigger(field,value.slice(0,field.props.LENGTH));setCurrent(value.slice(0,field.props.LENGTH));}};var blurTrigger=function blurTrigger(e){e.preventDefault();setTimeout(function(){setHeight(0);},135);};var focusTrigger=function focusTrigger(){setHeight(250);};var dataClickedTrigger=function dataClickedTrigger(data){setCurrent(data);changeTrigger(field,data[keyField]);};var generateData=function generateData(data){if(fields.length>0&&current){var listStr=fields.map(function(f){return data[f.field_alias];});return listStr.join(' - ');}else{return null;}};return/*#__PURE__*/_jsx(\"div\",{className:\"w-100-pct p-1 m-t-1\",children:!_fk?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"block text-16-px\",children:field.field_name})}),/*#__PURE__*/_jsx(\"div\",{className:\"m-t-0-5\",children:/*#__PURE__*/_jsx(\"input\",{type:field.props.props.AUTO_INCREMENT?\"text\":\"number\",className:\"p-t-0-5 p-b-0-5 p-l-1 text-16-px block w-100-pct border-1\",placeholder:\"\",onChange:fieldChangeData,value:current})})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"block text-16-px\",children:field.field_name})}),/*#__PURE__*/_jsx(\"div\",{className:\"m-t-0-5\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"p-t-0-5 p-b-0-5 p-l-1 text-16-px block w-100-pct border-1\",placeholder:\"\",onChange:fieldChangeData,defaultValue:generateData(current),onFocus:focusTrigger,onBlur:blurTrigger})}),/*#__PURE__*/_jsx(\"div\",{className:\"rel\",children:/*#__PURE__*/_jsx(\"div\",{className:\"abs-default w-100-pct no-overflow bg-white shadow\",style:{height:\"\".concat(height,\"px\")},children:/*#__PURE__*/_jsx(\"div\",{className:\"block w-100-pct p-0-5 overflow\",style:{height:\"\".concat(height,\"px\")},children:fkData.map(function(d,index){return/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-no-wrap hover pointer\",onClick:function onClick(){dataClickedTrigger(d);},children:fields?fields.map(function(field){return/*#__PURE__*/_jsx(\"div\",{className:\"div p-0-5 w-max-content\",children:/*#__PURE__*/_jsx(\"span\",{children:d[field.field_alias]})},field.field_id);}):null},index);})})})})]})});});","map":{"version":3,"names":["useState","useEffect","useSelector","props","field","changeTrigger","defaultValue","current","setCurrent","state","unique_string","proxy","_fk","_setFk","fkData","setFkData","fields","setFields","height","setHeight","keyField","setKeyField","constraints","length","fks","filter","c","constraint_type","fk","fetch","reference_on","then","res","json","data","table","table_id","foreignField","f","field_id","field_alias","AUTO_INCREMENT","result","auto_id","fieldChangeData","e","value","target","slice","LENGTH","blurTrigger","preventDefault","setTimeout","focusTrigger","dataClickedTrigger","generateData","listStr","map","join","field_name","d","index"],"sources":["D:/Nhan/DIPE_V2/Client/DIPE/APP/src/cpn/client/version/inputs/int.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useSelector } from 'react-redux';\r\n\r\nexport default ( props ) => {\r\n    const { field, changeTrigger, defaultValue } = props;\r\n    const [ current, setCurrent ] = useState(defaultValue ? defaultValue:\"\")\r\n\r\n    const { unique_string, proxy } = useSelector( state => state );\r\n    const [ _fk, _setFk ] = useState(0)\r\n    const [ fkData, setFkData ] = useState([]);\r\n    const [ fields, setFields ] = useState([]);\r\n    const [ height, setHeight ] = useState(0);\r\n    const [ keyField, setKeyField ] = useState(\"\")\r\n\r\n    useEffect(() => {\r\n        if( field.constraints && field.constraints.length > 0 ){\r\n            const fks = field.constraints.filter( c => c.constraint_type === \"fk\" );\r\n            const fk = fks[0]\r\n            _setFk( 1 )\r\n            fetch(`${proxy}/api/${ unique_string }/table/foreign/data/${ fk.reference_on }`)\r\n            .then( res => res.json() ).then( res => {\r\n                const { data, table } = res;\r\n                setFkData( data );\r\n                fetch(`${ proxy }/api/${ unique_string }/table/${ table.table_id }/fields`).then( res => res.json() )\r\n                .then( res => {\r\n                    const { fields } = res;\r\n                    setFields( fields );\r\n                    const foreignField = fields.filter( f => f.field_id === fk.reference_on )[0];\r\n                    setKeyField( foreignField.field_alias )\r\n                })\r\n            })\r\n        }\r\n        if( field.props.props.AUTO_INCREMENT ){\r\n            fetch(`${ proxy }/api/${ unique_string }/table/create/auto/increment/template/${ field.field_alias }`)\r\n            .then( res => res.json() ) .then( ({ result }) => {\r\n                const auto_id = result;\r\n                setCurrent(auto_id)\r\n                changeTrigger(field, auto_id)\r\n                /* LATENCY BUG */\r\n            })\r\n        }\r\n    }, [])\r\n\r\n    const fieldChangeData = (e) => {\r\n        if( !field.props.props.AUTO_INCREMENT ){\r\n            const { value } = e.target;\r\n            changeTrigger( field, value.slice(0, field.props.LENGTH) )\r\n            setCurrent( value.slice(0, field.props.LENGTH ))\r\n        }\r\n    }\r\n\r\n    const blurTrigger = (e) => {\r\n            e.preventDefault();\r\n            setTimeout(() => {\r\n                setHeight(0)\r\n        }, 135)\r\n    }\r\n\r\n    const focusTrigger = () => {\r\n        setHeight(250);\r\n    }\r\n\r\n    const dataClickedTrigger = ( data ) => {\r\n        setCurrent( data );\r\n        changeTrigger( field, data[ keyField ] )\r\n    }\r\n\r\n    const generateData = ( data ) => {\r\n\r\n        if( fields.length > 0 && current ){\r\n            const listStr = fields.map( f => data[ f.field_alias ] )\r\n            return listStr.join(' - ')\r\n        }else{\r\n            return null\r\n        }\r\n    }\r\n\r\n    return(\r\n        <div className=\"w-100-pct p-1 m-t-1\">\r\n        { !_fk ?\r\n            <div>\r\n                <div>\r\n                    <span className=\"block text-16-px\">{ field.field_name }</span>\r\n                </div>\r\n                <div className=\"m-t-0-5\">\r\n                    <input type={ field.props.props.AUTO_INCREMENT ?\"text\" : \"number\" }\r\n                        className=\"p-t-0-5 p-b-0-5 p-l-1 text-16-px block w-100-pct border-1\"\r\n                        placeholder=\"\" onChange={ fieldChangeData } value={ current }\r\n                        />\r\n                </div>\r\n            </div>\r\n        :\r\n            <div >\r\n                <div>\r\n                    <span className=\"block text-16-px\">{ field.field_name }</span>\r\n                </div>\r\n                <div className=\"m-t-0-5\">\r\n                    <input type=\"text\"\r\n                        className=\"p-t-0-5 p-b-0-5 p-l-1 text-16-px block w-100-pct border-1\"\r\n                        placeholder=\"\" onChange={ fieldChangeData } defaultValue={ generateData(current) }\r\n                        onFocus={ focusTrigger }\r\n                        onBlur={ blurTrigger }\r\n                        />\r\n\r\n                        {/* FOREIGN DATA SHOW AND CHOSE */}\r\n                </div>\r\n                <div className=\"rel\">\r\n                    <div className=\"abs-default w-100-pct no-overflow bg-white shadow\" style={{ height: `${ height }px` }}>\r\n                        <div className=\"block w-100-pct p-0-5 overflow\" style={{ height: `${ height }px` }}>\r\n                        { fkData.map( (d, index) =>\r\n                             <div key={ index } className=\"flex flex-no-wrap hover pointer\" onClick={ () => { dataClickedTrigger( d ) } }>\r\n                                { fields ? fields.map( field =>\r\n                                    <div key={field.field_id} className=\"div p-0-5 w-max-content\">\r\n                                        <span>{ d[ field.field_alias ] }</span>\r\n                                    </div>\r\n                                ) : null }\r\n                             </div>\r\n                          )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n     }\r\n        </div>\r\n    )\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}